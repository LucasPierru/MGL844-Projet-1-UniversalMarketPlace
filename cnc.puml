@startuml Compact_SEI_ECom_CnC_v2
' Compact SEI-style Component & Connector view (actor-free)
' DB shown with JDBC access and entity components

left to right direction
skinparam dpi 140
/' skinparam componentStyle rectangle '/
skinparam shadowing false
skinparam defaultFontName "Arial"
skinparam ArrowColor #333
skinparam nodesep 20
skinparam ranksep 30

title UniversalMarketPlace â€” Component & Connector View

' System boundary
component " " as SYS #eaf6e8 {
  skinparam rectangle {
    BackgroundColor #eaf6e8
    BorderColor #88b379
  }

  ' Edge / API row
  rectangle "API" as API {
    [LB L7] as LB
    [API Gateway\n] as APIGW
  }


  rectangle "Services" as Services {
    component "Servic Auth\n" as AuthSvc
    component "Service Compte\n" as UserSvc
    component "Service Produit\n" as ProductSvc
    component "Service Mise\n" as BidSvc
    component "Service Transaction\n" as TxSvc
    component "Service Notification\n" as NotifSvc
    portout "Redis Cache" as RedisSvc
  }


  ' Workers & infra
  /' [Worker Pool\n(async jobs)] as Workers '/
  queue "Message Broker\n(pub/sub, notifications)" as Broker

  ' Database entities
  rectangle "Entities" as Entities {
    component "UserEntity" as UserEntity
    component "ProductEntity" as ProdEntity
    component "BidEntity" as BidEntity
    component "OrderEntity" as OrderEntity
  }

  ' Ports
  portout "Database" as dbport
  portin "Web Client" as webClient
  portout "Logs" as Logs
  port "Payment Provider\n(Stripe)" as PaymentExt
  port " " as CommExt
}
' ---------- Connectors ----------
' Client to Load Balancer
webClient --> LB : <<HTTPS>>

' Edge to API
LB --> APIGW : <<TLS / routing>>
/' CDN --> APIGW : <<CDN>> '/
' Redis
RedisSvc --> Redis : cache

' API to services
APIGW --> AuthSvc
APIGW --> UserSvc
APIGW --> ProductSvc
APIGW --> BidSvc
APIGW --> TxSvc
APIGW --> NotifSvc

' Services to DB (JDBC arrows labeled)
AuthSvc -r-> UserEntity
UserSvc -r-> UserEntity
ProductSvc --> ProdEntity
BidSvc --> BidEntity
TxSvc --> OrderEntity

' Entities -> DB (explicit, like your example)
UserEntity -right-> dbport
ProdEntity -right-> dbport
BidEntity -right-> dbport
OrderEntity -right-> dbport
/' dbport -b-> PostgreSQL '/



' Broker (async notification flows)
BidSvc -[#2E8B57]-> Broker : BidPlacedEvent
Broker -[#2E8B57]-> NotifSvc : deliver notifications
NotifSvc -[#2E8B57]-> Broker : subscribe / publish (notifications)

' Supplier accept flow: BidSvc publishes acceptance to Broker which NotifSvc uses to notify client
BidSvc -[#2E8B57]-> Broker : BidAcceptedEvent

' Transaction flow (NO broker between Bid acceptance and TxSvc)
TxSvc -r-> PaymentExt : <<HTTPS>>
/' TxSvc -r-> NotifSvc '/
NotifSvc --> CommExt
SMTP - CommExt

' Workers for batch jobs (still can consume broker if needed)
/' Workers --> Broker : consume bkg tasks
Workers --> dbport : write job results '/

' Minimal notes
/' note left of BidSvc
  BidSvc responsibilities:
  - manage bid lifecycle
  - publish bid events to Broker for notifications
end note '/

legend right
  |=| Solid = synchronous (HTTP/gRPC/JDBC)
  |=| Green = asynchronous via Broker (pub/sub)
  |db| = relational DB
end legend

@enduml
